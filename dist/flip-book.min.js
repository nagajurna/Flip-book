function Flip(options){function moteur(interval){if(refreshEvent(),ctx.drawImage(img,x,y,width,height,0,0,canvas.width,canvas.height),counter+=1,cycleCounter+=1,panelsCounter+=1,counter==loops)return clearInterval(interval),inprog=null,element.dispatchEvent(completeEvent),document.dispatchEvent(completeEvent),void("first"===completePanel?(x=leftMargin,y=topMargin,imagesCounter=0,img=imgs[imagesCounter],setTimeout(function(){ctx.drawImage(img,x,y,width,height,0,0,canvas.width,canvas.height)},speed)):"none"===completePanel&&setTimeout(function(){element.style.visibility="hidden"},speed));if(panelsCounter%cols==0){if(x=leftMargin,cycleCounter==totalNumber)return y=topMargin,panelsCounter=0,cycleCounter=0,imagesCounter=0,void(img=imgs[imagesCounter]);if(panelsCounter==panelNumber)return y=topMargin,panelsCounter=0,void(imagesCounter<imgs.length-1&&(imagesCounter+=1,img=imgs[imagesCounter]));y+=height+gutterY}else x+=width+gutterX}var container,src,topMargin,leftMargin,cols,rows,width,height,gutterX,gutterY,speed,repeat,startPanel,stopPanel,completePanel,x,y,element,canvas,ratio,ctx,imgs,panelNumber,totalNumber,loops,initElement=function(){element=document.getElementById(container);var c=element.children,found=!1;for(i=0;i<c.length;i++){"CANVAS"==c[i].tagName&&(canvas=c[i]),found=!0;break}found===!1&&(canvas=document.createElement("canvas"),element.appendChild(canvas)),canvas.style.width="100%",ratio=height/width,canvas.height=ratio*canvas.width,ctx=canvas.getContext("2d"),completeEvent.detail.container=container,startEvent.detail.container=container,pauseEvent.detail.container=container,resumeEvent.detail.container=container,stopEvent.detail.container=container},initImage=function(){for(imgs=[],i=0;i<src.length;i++)img=new Image,img.src=src[i],imgs.push(img);"first"===startPanel?imgs[0].addEventListener("load",function(){ctx.drawImage(img,x,y,width,height,0,0,canvas.width,canvas.height)},!1):"last"===startPanel&&(x=leftMargin+(cols-1)*(width+gutterX),y=topMargin+(rows-1)*(height+gutterY),imagesCounter=imgs.length-1,imgs[imagesCounter].addEventListener("load",function(){ctx.drawImage(img,x,y,width,height,0,0,canvas.width,canvas.height)},!1))},initLoops=function(){panelNumber=cols*rows,totalNumber=panelNumber*src.length,loops=totalNumber*repeat},completeEvent=new CustomEvent("complete",{detail:{container:container,src:src}}),startEvent=new CustomEvent("start",{detail:{container:container,src:src}}),pauseEvent=new CustomEvent("pause",{detail:{container:container,src:src}}),resumeEvent=new CustomEvent("resume",{detail:{container:container,src:src}}),stopEvent=new CustomEvent("stop",{detail:{container:container,src:src}}),refreshEvent=function(){completeEvent.detail.src=src[imagesCounter],startEvent.detail.src=src[imagesCounter],pauseEvent.detail.src=src[imagesCounter],resumeEvent.detail.src=src[imagesCounter],stopEvent.detail.src=src[imagesCounter],completeEvent.detail.index=counter+1,startEvent.detail.index=counter+1,pauseEvent.detail.index=counter+1,resumeEvent.detail.index=counter+2,stopEvent.detail.index=counter+1};this.setContainer=function(option){if(void 0===option)throw new TypeError("Invalid flip() argument. Container must be defined");if("string"!=typeof option)throw new TypeError("Invalid flip() argument. Container must be string");if(""===option)throw new TypeError("Invalid flip() argument. Container must not be empty");container=option,initElement()},this.getContainer=function(){return container},this.setSrc=function(option){if(void 0===option)throw new TypeError("Invalid flip() argument. Src must be defined");if(option.constructor===Array){if(!(option.length>0))throw new TypeError("Invalid flip() argument. Src must not be empty");src=option,initImage(),initLoops()}else{if("string"!=typeof option)throw new TypeError("Invalid flip() argument. Src must be string or array");if(""===option)throw new TypeError("Invalid flip() argument. Src must not be empty");src=[],src.push(option),initImage(),initLoops()}},this.getSrc=function(){return src},this.setLeftMargin=function(option){leftMargin=void 0===option|"number"!=typeof option?0:option,x=leftMargin},this.getLeftMargin=function(){return leftMargin},this.setTopMargin=function(option){topMargin=void 0===option|"number"!=typeof option?0:option,y=topMargin},this.getTopMargin=function(){return topMargin},this.setCols=function(option){if(void 0===option)throw new TypeError("Invalid flip() argument. Cols must be defined");if("number"!=typeof option)throw new TypeError("Invalid flip() argument. Cols must be a number");cols=option,src&&initLoops()},this.getCols=function(){return cols},this.setRows=function(option){if(void 0===option)throw new TypeError("Invalid flip() argument. Rows must be defined");if("number"!=typeof option)throw new TypeError("Invalid flip() argument. Rows must be a number");rows=option,src&&initLoops()},this.getRows=function(){return rows},this.setWidth=function(option){if(void 0===option)throw new TypeError("Invalid flip() argument. Width must be defined");if("number"!=typeof option)throw new TypeError("Invalid flip() argument. Width must be a number");width=option,element&&initElement()},this.getWidth=function(){return width},this.setHeight=function(option){if(!(void 0!==option|"number"==typeof option))throw new TypeError("Invalid flip() argument. Height must be defined");if("number"!=typeof option)throw new TypeError("Invalid flip() argument. Height must be a number");height=option,element&&initElement()},this.getHeight=function(){return height},this.setGutterX=function(option){gutterX=void 0===option|"number"!=typeof option?0:option},this.getGutterX=function(){return gutterX},this.setGutterY=function(option){gutterY=void 0===option|"number"!=typeof option?0:option},this.getGutterY=function(){return gutterY},this.setSpeed=function(option){speed=void 0===option|"number"!=typeof option?100:option},this.getSpeed=function(){return speed},this.setRepeat=function(option){repeat="infinite"===option?null:void 0===option|"number"!=typeof option?1:option,src&&initLoops()},this.getRepeat=function(){return repeat},this.setStartPanel=function(option){startPanel=void 0===option|"string"!=typeof option|""===option?"first":option},this.getStartPanel=function(){return startPanel},this.setStopPanel=function(option){stopPanel=void 0===option|"string"!=typeof option|""===option?"last":option},this.getStopPanel=function(){return stopPanel},this.setCompletePanel=function(option){completePanel=void 0===option|"string"!=typeof option|""===option?"last":option},this.getCompletePanel=function(){return completePanel},this.setSrcOptions=function(options){this.setTopMargin(options.topMargin),this.setLeftMargin(options.leftMargin),this.setCols(options.cols),this.setRows(options.rows),this.setWidth(options.width),this.setHeight(options.height),this.setGutterX(options.gutterX),this.setGutterY(options.gutterY),this.setSrc(options.src)},this.setTopMargin(options.topMargin),this.setLeftMargin(options.leftMargin),this.setCols(options.cols),this.setRows(options.rows),this.setWidth(options.width),this.setHeight(options.height),this.setGutterX(options.gutterX),this.setGutterY(options.gutterY),this.setSpeed(options.speed),this.setRepeat(options.repeat),this.setStartPanel(options.startPanel),this.setStopPanel(options.stopPanel),this.setCompletePanel(options.completePanel),this.setSrc(options.src),this.setContainer(options.container);var interval,counter=0,cycleCounter=0,panelsCounter=0,imagesCounter=0,img=imgs[imagesCounter];refreshEvent();var inprog=null;this.start=function(){x=leftMargin,y=topMargin,void 0!==interval&&(clearInterval(interval),counter=0,cycleCounter=0,panelsCounter=0,imagesCounter=0,img=imgs[imagesCounter],refreshEvent()),interval=setInterval(function(){moteur(interval)},speed),setTimeout(function(){element.style.visibility="visible"},speed),inprog=!0,element.dispatchEvent(startEvent),document.dispatchEvent(startEvent)},this.pause=function(){1==inprog&&(clearInterval(interval),inprog=!1,element.dispatchEvent(pauseEvent),document.dispatchEvent(pauseEvent))},this.resume=function(){null!=interval&&inprog===!1&&(clearInterval(interval),interval=setInterval(function(){moteur(interval)},speed),inprog=!0,element.dispatchEvent(resumeEvent),document.dispatchEvent(resumeEvent))},this.stop=function(){null!=interval&&null!=inprog&&(refreshEvent(),clearInterval(interval),inprog=null,element.dispatchEvent(stopEvent),document.dispatchEvent(stopEvent),"last"===stopPanel?(x=leftMargin+(cols-1)*(width+gutterX),y=topMargin+(rows-1)*(height+gutterY),imagesCounter=imgs.length-1,img=imgs[imagesCounter],ctx.drawImage(img,x,y,width,height,0,0,canvas.width,canvas.height)):"first"===stopPanel?(x=leftMargin,y=topMargin,imagesCounter=0,img=imgs[imagesCounter],ctx.drawImage(img,x,y,width,height,0,0,canvas.width,canvas.height)):"none"===stopPanel&&(element.style.visibility="hidden"))}}